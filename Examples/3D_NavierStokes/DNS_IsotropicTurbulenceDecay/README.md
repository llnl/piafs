# Isotropic Turbulence Decay (Direct Numerical Simulation)

## Overview

Direct Numerical Simulation (DNS) of isotropic turbulence decay. This example simulates the decay of initially isotropic turbulent flow, capturing the full range of turbulent length scales without modeling. The initial solution is specified in the Fourier space with an energy distribution characteristic of turbulent flow, then transformed to physical space through an inverse Fourier transform.

## Governing Equations

3D Navier-Stokes equations for compressible flows:

```
d   [ rho   ]   d   [   rho*u    ]   d   [   rho*v    ]   d   [   rho*w    ]
--  [ rho*u ] + --  [rho*u*u + p ] + --  [  rho*u*v   ] + --  [  rho*u*w   ] = viscous terms
dt  [ rho*v ]   dx  [  rho*u*v   ]   dy  [rho*v*v + p ] + dz  [  rho*v*w   ]
    [ rho*w ]       [  rho*u*w   ]       [  rho*v*w   ]       [rho*w*w + p ]
    [   e   ]       [  (e+p)*u   ]       [  (e+p)*v   ]       [  (e+p)*w   ]
```

Where:
- `rho` - density
- `u` - x-velocity
- `v` - y-velocity
- `w` - z-velocity
- `p` - pressure
- `e` - total energy

Equation of state:
```
         p         1
e = -------  +   - rho * (u^2 + v^2 + w^2)
    gamma-1      2
```

## Domain and Boundary Conditions

- Domain: `0 <= x, y, z < 2*pi`
- Boundary conditions: Periodic on all boundaries

## Initial Conditions

The initial solution is specified in the Fourier space with an energy distribution similar to that of turbulent flow, then transformed to physical space through an inverse Fourier transform. See `aux/init.c` for implementation details.

## Required Input Files

- `solver.inp` - General solver parameters
- `boundary.inp` - Boundary conditions
- `physics.inp` - Physics-related parameters (including Reynolds number)
- `initial.inp` - Initial solution (generated by `aux/init.c`)

See the main PIAFS README for other optional input files.


## Input File Details

### solver.inp

```
begin
  ndims               3
  nvars               5
  size                64 64 64
  ghost               3
  n_iter              200
  restart_iter        0
  time_scheme         rk
  time_scheme_type    44
  hyp_space_scheme    crweno5
  hyp_interp_type     components
  par_space_type      nonconservative-2stage
  par_space_scheme    4
  dt                  0.025
  screen_op_iter      10
  file_op_iter        20
  ip_file_type        binary
  input_mode          serial
  op_file_format      binary
  op_overwrite        no
  model               navierstokes3d
end
```

| Parameter | Value | Description |
|-----------|-------|-------------|
| ndims | 3 | Number of spatial dimensions |
| nvars | 5 | Number of solution variables |
| size | 64 64 64 | Grid size (for 1D) or grid dimensions separated by spaces (for 2D/3D) |
| ghost | 3 | Number of ghost points |
| n_iter | 200 | Number of time iterations |
| restart_iter | 0 | Iteration number to restart from (if applicable) |
| time_scheme | rk | Time integration scheme (rk=Runge-Kutta, euler=Forward Euler) |
| time_scheme_type | 44 | RK scheme type (44=RK4, ssprk3=SSP-RK3, etc.) |
| hyp_space_scheme | crweno5 | Spatial discretization for hyperbolic terms (weno5, crweno5, muscl3, etc.) |
| hyp_interp_type | components | Interpolation type (characteristic, components) |
| par_space_type | nonconservative-2stage | Parabolic scheme type (nonconservative-1.5stage, etc.) |
| par_space_scheme | 4 | Parabolic term discretization (2, 4 for 2nd/4th order) |
| dt | 0.025 | Time step size |
| screen_op_iter | 10 | Iterations between screen output |
| file_op_iter | 20 | Iterations between file output |
| ip_file_type | binary | Parameter description |
| input_mode | serial | Parameter description |
| op_file_format | binary | Output format (text, binary, tecplot2d) |
| op_overwrite | no | Overwrite output files (yes, no) |
| model | navierstokes3d | Physical model (euler1d, navierstokes2d, navierstokes3d) |

### boundary.inp

```
6
periodic      0     1     0     0      0    6.3     0      6.3
periodic      0    -1     0     0      0    6.3     0      6.3
periodic      1     1     0   6.3      0      0     0      6.3
periodic      1    -1     0   6.3      0      0     0      6.3
periodic      2     1     0   6.3      0    6.3     0        0
periodic      2    -1     0   6.3      0    6.3     0        0
```

The boundary.inp file format:
- First line: Number of boundary specifications (6)
- Each subsequent line: type dim face xmin xmax

| Parameter | Description |
|-----------|-------------|
| type | Boundary condition type (periodic, extrapolate, noslip, slip-wall, supersonic_inflow, supersonic_outflow, subsonic_inflow, subsonic_outflow) |
| dim | Spatial dimension (0=x, 1=y, 2=z) |
| face | Face identifier (1=right/top/front, -1=left/bottom/back) |
| xmin, xmax | Range where BC applies |

### physics.inp

```
begin
  gamma     1.4
  upwinding roe
  Pr        0.72
  Minf      0.3
  Re        333.333333333333333
end
```

| Parameter | Value | Description |
|-----------|-------|-------------|
| gamma | 1.4 | Ratio of specific heats (typically 1.4 for air) |
| upwinding | roe | Upwinding scheme (rf-char=Roe-fixed characteristic, rusanov, etc.) |
| Pr | 0.72 | Prandtl number |
| Minf | 0.3 | Freestream Mach number |
| Re | 333.333333333333333 | Reynolds number |

### weno.inp

```
begin
  mapped        1
  borges        0
  yc            0
  no_limiting   0
  epsilon       0.000001
  p             2.0
  rc            0.3
  xi            0.001
end
```

| Parameter | Value | Description |
|-----------|-------|-------------|
| mapped | 1 | Use mapped WENO (0=no, 1=yes) |
| borges | 0 | Use Borges mapping (0=no, 1=yes) |
| yc | 0 | Use Yamaleev-Carpenter mapping (0=no, 1=yes) |
| no_limiting | 0 | Disable limiting (0=limiting on, 1=no limiting) |
| epsilon | 0.000001 | Small number to avoid division by zero |
| p | 2.0 | Exponent in WENO weights |
| rc | 0.3 | Critical ratio for mapped WENO |
| xi | 0.001 | Parameter for WENO-Z scheme |

### lusolver.inp

```
begin
  reducedsolvetype  jacobi
  evaluate_norm     0
  maxiter           10
  atol              1e-12
  rtol              1e-10
  verbose           0
end
```

| Parameter | Value | Description |
|-----------|-------|-------------|
| reducedsolvetype | jacobi | Parameter description |
| evaluate_norm | 0 | Calculate norms (yes, no) |
| maxiter | 10 | Maximum iterations |
| atol | 1e-12 | Absolute tolerance |
| rtol | 1e-10 | Relative tolerance |
| verbose | 0 | Verbosity level (0=silent, 1=summary, 2=detailed) |


## How to Run

1. **Generate the initial solution:**
   ```bash
   cd Examples/3D_NavierStokes/DNS_IsotropicTurbulenceDecay
   # Compile with FFTW3 library
   gcc -I/path/to/fftw3.h -L/path/to/libfftw3.a -lfftw3 aux/init.c -o INIT -lm
   ./INIT
   ```

2. **Run the simulation:**
   ```bash
   # Serial mode
   /path/to/piafs/bin/PIAFS-<compiler>-serial solver.inp

   # Parallel mode (e.g., 8 processes)
   mpiexec -n 8 /path/to/piafs/bin/PIAFS-<compiler>-mpi solver.inp
   ```

3. **Visualize results:**
   - If `op_file_format` is set to `text` in `solver.inp`, solution files can be plotted with Gnuplot or any plotting tool
   - Use Python scripts in `Examples/Python/` for binary format output

4. **Analyze spectral properties (optional):**
   ```bash
   # Compile Fourier analysis tool
   gcc -I/path/to/fftw3.h -L/path/to/libfftw3.a -lfftw3 aux/fourier.c -o FOURIER -lm
   ./FOURIER
   ```

5. **Analyze kinetic energy evolution (optional):**
   ```bash
   # Compile kinetic energy calculation tool
   gcc aux/kineticenergy.c -o KINETICENERGY -lm
   ./KINETICENERGY
   ```

## Notes

- The code `aux/init.c` generates the initial solution file in the correct format required by the solver
- The code `aux/fourier.c` can be used to calculate the initial and final spectrum of the solution
- The code `aux/kineticenergy.c` can be used to calculate the time evolution of the kinetic energy
- Both `aux/init.c` and `aux/fourier.c` require the FFTW3 library (http://www.fftw.org)
- This is a computationally intensive simulation that requires adequate grid resolution to capture all turbulent scales
- The decay of turbulent kinetic energy and the evolution of the energy spectrum are important validation metrics
- This case tests both the inviscid flux computation and the viscous terms implementation
